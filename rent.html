<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì±… ëŒ€ì—¬</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .clickable { color: red; cursor: pointer; }
    .unclickable { color: gray; cursor: not-allowed; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA8JDO1tZba-PE5djiG72o8LoU-e_absPU",
      authDomain: "book-rental-af96d.firebaseapp.com",
      projectId: "book-rental-af96d",
      storageBucket: "book-rental-af96d.appspot.com",
      messagingSenderId: "233876020916",
      appId: "1:233876020916:web:e32930ebc6e920103a41e1"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    async function rentBook(title) {
      const docRef = await db.collection("books").where("title", "==", title).get();
      if (docRef.empty) return alert("ì±…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
      const doc = docRef.docs[0];
      const book = doc.data();
      if (!book.available) return alert("ì´ë¯¸ ëŒ€ì—¬ ì¤‘ì¸ ì±…ì…ë‹ˆë‹¤.");
      document.getElementById("form-section").style.display = "block";
      document.getElementById("book-title").innerText = title;
      window.currentDocId = doc.id;
    }
    async function submitForm(event) {
      event.preventDefault();
      const name = document.getElementById("name").value;
      const org = document.getElementById("org").value;
      const pw = document.getElementById("pw").value;
      const today = new Date();
      const returnDate = new Date();
      returnDate.setDate(today.getDate() + 20);
      await db.collection("books").doc(window.currentDocId).update({
        available: false,
        borrower: name,
        password: pw,
        daysLeft: 20
      });
      alert(`ë°˜ë‚©ì¼ì€ ${returnDate.toLocaleDateString()} ì…ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!`);
      window.location.href = "list.html";
    }
  </script>
</head>
<body>
  <h1>ğŸ“• ì±… ëŒ€ì—¬</h1>
  <p class="clickable" onclick="rentBook('ìƒê°ì˜ ì—°ê¸ˆìˆ ')">ìƒê°ì˜ ì—°ê¸ˆìˆ  â€“ ì œì„ìŠ¤ ì•Œë Œ</p>
  <div id="form-section" style="display:none;">
    <h2 id="book-title"></h2>
    <form onsubmit="submitForm(event)">
      ì´ë¦„: <input type="text" id="name" required><br>
      ì†Œì†: <input type="text" id="org" required><br>
      ë¹„ë°€ë²ˆí˜¸(4ìë¦¬): <input type="password" id="pw" maxlength="4" required><br>
      <button type="submit">ëŒ€ì—¬ ì‹ ì²­</button>
    </form>
  </div>
</body>
</html>
